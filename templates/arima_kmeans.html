<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ARIMA + K-Means Hybrid Clustering</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background-color: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .content {
        padding: 40px;
      }

      .form-section {
        background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .form-section h2 {
        color: #d63031;
        margin-bottom: 20px;
        font-size: 1.8em;
        text-align: center;
      }

      .form-group {
        margin-bottom: 25px;
      }

      .form-group label {
        display: block;
        color: #2d3436;
        font-weight: bold;
        margin-bottom: 10px;
        font-size: 1.1em;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 15px;
        border: 2px solid #dfe6e9;
        border-radius: 8px;
        font-size: 1em;
        background-color: white;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #e74c3c;
      }

      .slider-container {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .slider-container input[type="range"] {
        flex: 1;
        height: 8px;
        border-radius: 5px;
        background: linear-gradient(to right, #e74c3c 0%, #c0392b 100%);
        outline: none;
        -webkit-appearance: none;
      }

      .slider-container input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #e74c3c;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }

      .slider-container input[type="range"]::-moz-range-thumb {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #e74c3c;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }

      .slider-value {
        font-size: 1.5em;
        font-weight: bold;
        color: #e74c3c;
        min-width: 80px;
        text-align: center;
        background: white;
        padding: 10px 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .btn-submit {
        width: 100%;
        padding: 18px;
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.2em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3);
      }

      .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(231, 76, 60, 0.4);
      }

      .info-banner {
        background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
        color: white;
        padding: 20px 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .info-banner h3 {
        font-size: 1.5em;
        margin-bottom: 10px;
      }

      .info-banner p {
        font-size: 1.1em;
        line-height: 1.6;
      }

      .info-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .info-card {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: transform 0.3s ease;
      }

      .info-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15);
      }

      .info-card h3 {
        color: #e74c3c;
        font-size: 1em;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .info-card p {
        font-size: 2em;
        font-weight: bold;
        color: #333;
      }

      .visualization {
        background-color: #f9f9f9;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        margin-bottom: 30px;
      }

      .visualization h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.8em;
      }

      .map-container {
        width: 100%;
        height: 750px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        overflow: hidden;
      }

      .map-container iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      .cluster-stats {
        background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        color: white;
      }

      .cluster-stats h3 {
        color: white;
        margin-bottom: 20px;
        font-size: 1.8em;
        text-align: center;
      }

      .cluster-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .cluster-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-left: 5px solid #e74c3c;
      }

      .cluster-card.cluster-0 {
        border-left-color: #2ecc71;
      }

      .cluster-card.cluster-1 {
        border-left-color: #f39c12;
      }

      .cluster-card.cluster-2 {
        border-left-color: #e74c3c;
      }

      .cluster-card h4 {
        color: #2d3436;
        margin-bottom: 15px;
        font-size: 1.3em;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .cluster-badge {
        background: #e74c3c;
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: bold;
      }

      .cluster-card.cluster-0 .cluster-badge {
        background: #2ecc71;
      }

      .cluster-card.cluster-1 .cluster-badge {
        background: #f39c12;
      }

      .cluster-card.cluster-2 .cluster-badge {
        background: #e74c3c;
      }

      .cluster-stats-item {
        margin-bottom: 12px;
        color: #555;
        font-size: 1em;
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #ecf0f1;
      }

      .cluster-stats-item:last-child {
        border-bottom: none;
      }

      .cluster-stats-item strong {
        color: #2d3436;
      }

      .cluster-countries {
        margin-top: 15px;
      }

      .cluster-countries h5 {
        color: #555;
        margin-bottom: 10px;
        font-size: 0.95em;
      }

      .country-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .country-tag {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: #2d3436;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.85em;
        font-weight: 600;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .description {
        background-color: #f0f4f8;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        border-left: 5px solid #e74c3c;
      }

      .description h3 {
        color: #e74c3c;
        margin-bottom: 15px;
        font-size: 1.5em;
      }

      .description p {
        color: #555;
        line-height: 1.8;
        margin-bottom: 15px;
      }

      .description ul {
        margin-left: 20px;
        margin-top: 10px;
      }

      .description li {
        color: #555;
        line-height: 1.8;
        margin-bottom: 8px;
      }

      .description strong {
        color: #2d3436;
      }

      .error-message {
        background-color: #ff7675;
        color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: bold;
      }

      .navigation {
        display: flex;
        justify-content: space-between;
        gap: 20px;
        margin-top: 30px;
      }

      .btn {
        flex: 1;
        padding: 15px 30px;
        text-decoration: none;
        text-align: center;
        border-radius: 8px;
        font-weight: bold;
        font-size: 1em;
        transition: all 0.3s ease;
        display: inline-block;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
      }

      .btn-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
      }

      .btn-success {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 1.8em;
        }

        .navigation {
          flex-direction: column;
        }

        .info-cards {
          grid-template-columns: 1fr;
        }

        .cluster-grid {
          grid-template-columns: 1fr;
        }

        .map-container {
          height: 500px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üîÆ ARIMA + K-Means Hybrid Clustering</h1>
        <p>Future Prediction & Re-Clustering Based on Prediction Results</p>
      </div>

      <div class="content">
        <!-- Info Banner Singkat -->
        <div style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; padding: 15px 30px; border-radius: 10px; margin-bottom: 25px; text-align: center;">
          <p style="margin: 0; font-size: 1.1em; line-height: 1.6;">
            üí° <strong>ARIMA + K-Means Hybrid:</strong> Combination of time-series prediction with dynamic clustering. Select prediction year below the map to see clusters based on future predictions.
          </p>
        </div>
        
        {% if error_message %}
        <div class="error-message">‚ùå {{ error_message }}</div>
        {% endif %} {% if map_html %}
        <div class="info-cards">
          <div class="info-card">
            <h3>Number of Countries</h3>
            <p>{{ total_countries }}</p>
          </div>
          <div class="info-card">
            <h3>Number of Clusters</h3>
            <p>{{ n_clusters }}</p>
          </div>
          <div class="info-card">
            <h3>
              {% if is_prediction %}Prediction Year{% else %}Data Year{% endif
              %}
            </h3>
            <p>{{ prediction_year }}</p>
          </div>
          <div class="info-card">
            <h3>
              {% if is_prediction %}Prediction Range{% else %}Data Source{% endif
              %}
            </h3>
            <p>
              {% if is_prediction %}{{ years_to_predict }} Year{% else
              %}Historical{% endif %}
            </p>
          </div>
        </div>

        <div class="visualization">
          <h2>
            üåç {% if is_prediction %}Interactive Map - Clustering Based on
            Predictions{% else %}Interactive Map - Historical Data Clustering{% endif
            %}
          </h2>
          
          <!-- Dropdown control di atas peta -->
          <div style="background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); padding: 20px; border-radius: 10px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 15px;">
            <form method="POST" style="display: flex; align-items: center; gap: 15px; margin: 0;">
              <label for="years" style="color: #2d3436; font-weight: bold; font-size: 1.1em;">
                üìÖ Select Prediction Year:
              </label>
              <select 
                id="years" 
                name="years"
                style="padding: 10px 20px; font-size: 1em; border: 2px solid #e74c3c; border-radius: 8px; background: white; color: #2d3436; font-weight: bold; cursor: pointer; min-width: 150px;">
                <option value="1" {% if years_to_predict == 1 %}selected{% endif %}>{{ base_year + 1 }}</option>
                <option value="2" {% if years_to_predict == 2 %}selected{% endif %}>{{ base_year + 2 }}</option>
                <option value="3" {% if years_to_predict == 3 %}selected{% endif %}>{{ base_year + 3 }}</option>
                <option value="4" {% if years_to_predict == 4 %}selected{% endif %}>{{ base_year + 4 }}</option>
                <option value="5" {% if years_to_predict == 5 %}selected{% endif %}>{{ base_year + 5 }}</option>
              </select>
              <button 
                type="submit" 
                style="padding: 10px 25px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 1em; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                üöÄ Generate
              </button>
            </form>
          </div>
          
          <div class="map-container">
            <iframe src="{{ url_for('static', filename=map_html) }}"></iframe>
          </div>
        </div>

        <div class="cluster-stats">
          <h3>üìä Detailed Statistics for Each Cluster</h3>
          <div class="cluster-grid">
            {% for cluster_id, stats in cluster_stats.items() %}
            <div class="cluster-card cluster-{{ cluster_id }}">
              <h4>
                <span class="cluster-badge">Cluster {{ cluster_id }}</span>
                <span>
                  {% if cluster_id == 0 %} Low Risk üü¢ {% elif cluster_id
                  == 1 %} Medium Risk üü° {% else %} High Risk üî¥ {% endif
                  %}
                </span>
              </h4>

              <div class="cluster-stats-item">
                <span>Number of Countries:</span>
                <strong>{{ stats.count }}</strong>
              </div>
              <div class="cluster-stats-item">
                <span
                  >{% if is_prediction %}Average Prediction{% else %}Average
                  Historical{% endif %}:</span
                >
                <strong>{{ "{:,.0f}".format(stats.avg_prediction) }}</strong>
              </div>
              <div class="cluster-stats-item">
                <span
                  >{% if is_prediction %}Minimum Prediction{% else %}Minimum
                  Value{% endif %}:</span
                >
                <strong>{{ "{:,.0f}".format(stats.min_prediction) }}</strong>
              </div>
              <div class="cluster-stats-item">
                <span
                  >{% if is_prediction %}Maximum Prediction{% else %}Maximum
                  Value{% endif %}:</span
                >
                <strong>{{ "{:,.0f}".format(stats.max_prediction) }}</strong>
              </div>

              <div class="cluster-countries">
                <h5>üìç Example Countries (Top 10):</h5>
                <div class="country-tags">
                  {% for country in stats.countries %}
                  <span class="country-tag">{{ country }}</span>
                  {% endfor %}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>

        <div class="description">
          <h3>üìñ Methodology Explanation</h3>

          <p>
            <strong>Hybrid ARIMA + K-Means Process:</strong>
          </p>
          <ul>
            <li>
              <strong>Step 1 - Pre-compute ARIMA Models:</strong> ARIMA models
              for each country have been pre-trained and stored in
              cache for fast performance
            </li>
            <li>
              <strong>Step 2 - Generate Predictions:</strong> System retrieves
              ARIMA models from cache and generates predictions for N years
              ahead (according to user selection)
            </li>
            <li>
              <strong>Step 3 - Calculate Average:</strong> For each country,
              the average prediction value over N years is calculated
            </li>
            <li>
              <strong>Step 4 - K-Means Clustering:</strong> K-Means algorithm
              performs re-clustering based on those average prediction values
            </li>
            <li>
              <strong>Step 5 - Visualization:</strong> Clustering results are
              visualized on an interactive world map
            </li>
          </ul>

          <p><strong>Cluster Interpretation:</strong></p>
          <ul>
            <li>
              <strong>Cluster 0 (Green - Low Risk):</strong> Countries with
              low predicted stroke deaths in the future
            </li>
            <li>
              <strong>Cluster 1 (Yellow - Medium Risk):</strong> Countries with
              medium predicted stroke deaths
            </li>
            <li>
              <strong>Cluster 2 (Red - High Risk):</strong> Countries with
              high predicted stroke deaths that need special attention
            </li>
          </ul>

          <p><strong>Advantages of This Hybrid Method:</strong></p>
          <ul>
            <li>
              <strong>Caching:</strong> ARIMA models are pre-cached so the web
              loads fast without needing to retrain
            </li>
            <li>
              <strong>Flexibility:</strong> Users can select prediction range
              (1-5 years) according to analysis needs
            </li>
            <li>
              <strong>Dynamic Re-clustering:</strong> Clustering is performed
              real-time based on different prediction results
            </li>
            <li>
              <strong>Interactive Visualization:</strong> Interactive world map
              facilitates geographic data exploration
            </li>
          </ul>
        </div>

        {% endif %}

        <div class="navigation">
          <a href="/" class="btn btn-primary">üè† Home Page</a>
          <a href="/kmeans" class="btn btn-secondary">üó∫Ô∏è K-Means (Original)</a>
          <a href="/arima" class="btn btn-success">üìà ARIMA Prediction</a>
        </div>
      </div>
    </div>
  </body>
</html>
